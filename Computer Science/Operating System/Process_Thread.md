# 프로세스와 스레드
 
 

[프로세스](#프로세스-process)  
[스레드](#스레드-thread)

## 프로세스 (Process)
> 프로그램 : **파일이 저장 장치에 저장되어 있지만 메모리에는 올라가 있지 않은 정적인 상태**  
프로세스 : 메모리 상에서 **실행중인 프로그램의 인스턴스(객체)**,
 운영체제로부터 **시스템 자원을 할당받는 작업의 단위**

### **프로그램 -> 프로세스** -> 스레드

먼저 프로세스와 스레드에 설명하기 전에 프로그램에 대해 먼저 알아야 합니다.  
쉽게 말해 **프로그램**은 `어떤 작업을 실행할 수 있는 파일`이자 `그냥 코드 덩어리`입니다.

프로그램이 실행하게 되면, 해당 파일은 컴퓨터 메모리에 올라가게 되고, 이 상태를 **동적인 상태**라고 합니다.  
이 상태의 프로그램을 `프로세스`라고 합니다.

>요약 : 프로그램(코드 덩어리 파일) -> (실행) -> 프로세스

이 내용을 쉽게 그림으로 표현하면 다음과 같습니다.

![image](https://user-images.githubusercontent.com/37105602/223342958-3a02da92-cc7d-49ca-acef-be6159804a02.png)


- ### 운영체제로부터 할당 받는 시스템 자원의 예
    - CPU 시간
    - 운영되기 위해 필요한 주소 공간
    - Code, Data, Stack, Heap의 구조로 되어 있는 독립된 메모리 영역

- ### 특징
![image](https://user-images.githubusercontent.com/37105602/223338361-de04dca1-8534-4584-956a-44f5d72a780d.png)

    - 프로세스는 각각 독립된 메모리 영역 (Code, Data, Stack, Heap의 구조)를 할당받습니다.
    - 기본적으로 프로세스당 최소 1개의 스레드(메인 스레드)를 가지고 있습니다.
    - 각 프로세스는 별도의 주소 공간에 실행되며, 한 프로세스는 다른 프로세스의 변수나 자료구조에 접근 불가합니다.
    - 한 프로세스가 다른 프로세스의 자원에 접근하려면 프로세스간의 통신(IPC, inter-process Communication)을 사용해야 합니다.
        - Ex) 파이프, 파일, 소켓 등을 이용한 통신 방법 이용



## 스레드 (Thread)
>스레드 : 프로세스 안에서 실행되는 흐름 단위, 프로세스의 특정한 수행 경로 

### **프로세스 -> 스레드**

과거에는 프로그램 실행에서부터 종료까지 프로세스 하나만 사용하여 진행했었습니다. 하지만 시간이 흐르면서 프로그램이 복잡해지면서 프로세스 하나만을 사용하여 프로그램을 실행하기 벅차게 되었습니다.

이 상황을 해결하기 위해 "프로세스를 여러개 만들면 되지 않을까"라는 생각을 했었지만, 운영체제는 안전성을 위해 프로세스마다 자신에게 할당된 메모리 내의 정보만 접근할 수 있도록 제약을 두었기에 불가능 했습니다.

그렇게 프로세스와 다른 더 작은 실행 단위 개념이 필요하게 되었고, 이 개념이 `스레드`입니다.

- ### 특징
![image](https://user-images.githubusercontent.com/37105602/223337276-7bdbbdbf-d314-4da6-9e5f-f8c19e6bfa2c.png)

    - 스레드는 프로세스 내에서 각각 Stack만 따로 할당받고 Code, Data, Heap 영역은 공유합니다.
    - 스레드는 한 프로세스 내에서 동작되는 여러 실행의 흐름으로, 프로세스 내의 주소 공간이나 자원들(힙 공간 등)을 같은 프로세스 내에 스레드끼리 공유하면서 실행됩니다.
    - 같은 프로세스 안에 있는 여러 스레드들은 같은 힙 공간을 공유합니다. 반면에 프로세스는 다른 프로세스의 메모리에 직접 접근할 수 없습니다.
    - 각각의 스레드는 별도의 레지스터와 스택을 갖고 있지만, 힙 메모리는 서로 읽고 쓸 수 있습니다.
    - 한 스레드가 프로세스 자원을 변경하면, 다른 이웃 스레드도 그 변경 결과를 즉시 볼 수 있습니다.

## 멀티 프로세스와 멀티 스레드

### 멀티 프로세스
> 하나의 프로그램을 여러개의 프로세스로 구성하여 각 프로세스가 병렬적으로 작업을 수행하는 것

장점
- 안전성 (메모리 침범 문제를 OS 차원에서 해결)

단점
- 각각 독립된 메모리 영역을 가지고 있어, 작업량이 많을 수록 오버헤드 발생
- **Context Switching**으로 인한 성능 저하

*Context Switching*
> 프로세스의 상태 정보를 저장하고 복원하는 일련의 과정
>
> 즉, 동작 중인 프로세스가 대기하면서 해당 프로세스의 상태를 보관하고, 대기하고 있던 다음 순번의 프로세스가 동작하면서 이전에 보관했던 프로세스 상태를 복구하는 과정을 말합니다.
>
> -> 프로세스는 각 독립된 메모리 영역을 할당받아 사용되므로, 캐시 메모리 초기화와 같은 무거운 작업이 진행되었을 때 오버헤드가 발생할 문제가 존재합니다.


### 멀티 스레드
>하나의 응용 프로그램에서 여러 스레드를 구성해 각 스레드가 하나의 작업을 처리하는 것

스레드들이 공유 메모리를 통해 다수의 작업을 동시에 처리하도록 해줍니다.

장점
- 독립적인 프로세스에 비해 공유 메모리만큼의 시간, 자원 손실이 감소
- 전역 변수와 정적 변수에 대한 자료 공유 가능

단점
- 안전성 문제
- 하나의 스레드가 데이터 공간을 무너드리면, 모든 스레드가 작동 불능 상태에 빠집니다.(공유 메모리를 갖기 때문)

-> 멀티 스레드의 안전성에 대한 단점은 Critical Section 기법을 통해 대비합니다.
> 하나의 스레드가 공유 데이터 값을 변경하는 시점에 다른 스레드가 그 값을 읽으려할 때 발생하는 문제를 해결하기 위한 동기화 과정
>```
>상호 배제, 진행, 한정된 대기를 충족해야합니다.
>```




## Reference
https://gmlwjd9405.github.io/2018/09/14/process-vs-thread.html  
https://velog.io/@raejoonee/%ED%94%84%EB%A1%9C%EC%84%B8%EC%8A%A4%EC%99%80-%EC%8A%A4%EB%A0%88%EB%93%9C%EC%9D%98-%EC%B0%A8%EC%9D%B4